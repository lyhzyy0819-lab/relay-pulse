version: '3.8'

services:
  monitor:
    image: ghcr.io/prehisle/relay-pulse:latest

    # 本地构建（取消注释）:
    # build:
    #   context: .
    #   dockerfile: Dockerfile

    container_name: relaypulse-monitor

    ports:
      - "8080:8080"

    volumes:
      - ./config.yaml:/app/config.yaml:ro
      - relay-pulse-data:/app

    environment:
      - TZ=Asia/Shanghai

    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

    restart: unless-stopped

    networks:
      - relay-pulse-network

volumes:
  relay-pulse-data:
    driver: local

networks:
  relay-pulse-network:
    driver: bridge

# ============================================
# Docker Compose V1 兼容版本
# ============================================
#
# 此文件是为 docker-compose 1.x 版本优化的配置
# 移除了可能导致兼容性问题的高级特性
#
# 使用方法：
#   docker-compose -f docker-compose.v1.yaml up -d
#
# 推荐升级到 Docker Compose V2：
#   apt-get install docker-compose-plugin
#   docker compose up -d
# ============================================
